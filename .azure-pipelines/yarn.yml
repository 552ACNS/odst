variables:
  YARN_CACHE_FOLDER: $(Pipeline.Workspace)/.yarn

steps:
  - checkout: self
    clean: false 
  - task: UseNode@1
    inputs:
    version: '16.13.x'
    checkLatest: true
    displayName: 'Install LTS of Node.js'
  - task: Cache@2
    inputs:
      key: '"yarn" | "$(Agent.OS)" | yarn.lock'
      restoreKeys: |
       yarn | "$(Agent.OS)"
       yarn
      path: $(YARN_CACHE_FOLDER)
    displayName: Cache Node modules
  - script: npm install -g yarn
    displayName: Install yarn
  - script: npm install -g nx
    displayName: Install nx
  - script: |
      yarn install --ignore-engines --frozen-lockfile
    displayName: Install dependencies only if there is no cache available
    condition: ne(variables['CacheRestored'], 'true')
